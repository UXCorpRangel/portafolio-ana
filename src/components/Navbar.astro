---
import { getLocalePath, t } from 'i18n:astro'
import Logo from '@components/Logo.astro'
import LanguageToggle from '@components/LanguageToggle.astro'

const SLUGS = [
  { slug: getLocalePath('/') },
  { slug: getLocalePath('/sobre-mi') }
]

const LINKS = t('navbar', { returnObjects: true })
---

<header class="nav-container">
  <a href={getLocalePath('/')}>
    <Logo />
  </a>

  <nav class="navbar" data-status="close" aria-hidden="true">
    <ul class="list">
      {
        SLUGS.map(({ slug }, index) => (
          <>
            <li class:list={['list-item', { active: Astro.url.pathname === slug }]}>
              <a href={slug}>{LINKS[index]}</a>
            </li>
            <li class="dots">&#183;</li>
          </>
        ))
      }

      <!-- PROYECTOS -->
      <li class="list-item has-mega" data-mega="projects">
        <a href="#" class="mega-trigger" aria-haspopup="true" aria-expanded="false">
          Proyectos
        </a>

        <div class="mega-panel" role="menu" aria-label="Proyectos">
          <div class="mega-grid mega-grid-1">
            <div class="mega-col">
              <h3 class="mega-col-title">Proyectos</h3>

              <a class="mega-item" href="/banco-ripley">
                <div class="mega-thumb"><img src="/assets/proyectos/banco_converted.webp" alt=""></div>
                <div class="mega-text">
                  <div class="mega-title">Banco Ripley</div>
                  <div class="mega-subtitle">Autonomìa, research y prototipado</div>
                </div>
              </a>

              <a class="mega-item" href="#">
                <div class="mega-thumb"><img src="/assets/proyectos/cenco_converted.webp" alt=""></div>
                <div class="mega-text">
                  <div class="mega-title">Cencosud</div>
                  <div class="mega-subtitle">Liderazgo, estrategia, testing, MVP</div>
                </div>
              </a>

              <a class="mega-item" href="/latam-airlines">
                <div class="mega-thumb"><img src="/assets/proyectos/latam_converted.webp" alt=""></div>
                <div class="mega-text">
                  <div class="mega-title">Latam</div>
                  <div class="mega-subtitle">Diseño UX Potenciado por IA</div>
                </div>
              </a>

              <a class="mega-item" href="/firma-fast">
                <div class="mega-thumb"><img src="/assets/proyectos/ff_converted.webp" alt=""></div>
                <div class="mega-text">
                  <div class="mega-title">Firma Fast</div>
                  <div class="mega-subtitle">Rediseño, vibe coding, estrategia, escalamiento</div>
                </div>
              </a>
            </div>
          </div>
        </div>
      </li>
      <li class="dots">&#183;</li>

      <!-- EVENTOS -->
      <li class="list-item has-mega" data-mega="events">
        <a href="#" class="mega-trigger" aria-haspopup="true" aria-expanded="false">
          Eventos
        </a>

        <div class="mega-panel" role="menu" aria-label="Eventos">
          <div class="mega-grid mega-grid-2">
            <div class="mega-col">
              <h3 class="mega-col-title">Participante</h3>

              <a class="mega-item" href="/eventos/nerdearla">
                <div class="mega-thumb"><img src="/img/nerdearla-logo.png" alt=""></div>
                <div class="mega-text">
                  <div class="mega-title">Nerdearla</div>
                  <div class="mega-subtitle">Charlista de MVP y user flow</div>
                </div>
              </a>

              <a class="mega-item" href="/eventos/awesome-fest">
                <div class="mega-thumb"><img src="/assets/proyectos/getonboard_converted.webp" alt=""></div>
                <div class="mega-text">
                  <div class="mega-title">Awesome Fest 2024</div>
                  <div class="mega-subtitle">Host</div>
                </div>
              </a>

              <a class="mega-item" href="/eventos/jsconf-chile">
                <div class="mega-thumb"><img src="/assets/proyectos/js_converted.webp" alt=""></div>
                <div class="mega-text">
                  <div class="mega-title">JSconf 2024</div>
                  <div class="mega-subtitle">Organizadora</div>
                </div>
              </a>
            </div>

            <div class="mega-col">
              <h3 class="mega-col-title">Charlista</h3>

              <a class="mega-item" href="#">
                <div class="mega-thumb"><img src="/img/nerdearla-logo.png" alt=""></div>
                <div class="mega-text">
                  <div class="mega-title">AI-first sin UI-first</div>
                  <div class="mega-subtitle">Santiago de Chile. Pròximamente</div>
                </div>
              </a>
              <a class="mega-item" href="https://www.youtube.com/watch?v=0LZEeA8TUU4&t=684s" target="_blank" rel="noopener noreferrer">
                <div class="mega-thumb"><img src="/img/nerdearla-logo.png" alt=""></div>
                <div class="mega-text">
                  <div class="mega-title">UX al AX</div>
                  <div class="mega-subtitle">Buenos aires, Argentina 2025</div>
                </div>
              </a>
              <a class="mega-item" href="https://www.youtube.com/watch?v=RwKwSJ-YmW8&t=2s" target="_blank" rel="noopener noreferrer">
                <div class="mega-thumb"><img src="/assets/proyectos/duoc_converted.webp" alt=""></div>
                <div class="mega-text">
                  <div class="mega-title">Derribando Mitos de la IA</div>
                  <div class="mega-subtitle">Santiago de Chile, 2025</div>
                </div>
              </a>
              <a class="mega-item" href="https://www.youtube.com/watch?v=BasBLkIvOnE&t=1567s" target="_blank" rel="noopener noreferrer">
                <div class="mega-thumb"><img src="/assets/proyectos/edison_converted.webp" alt=""></div>
                <div class="mega-text">
                  <div class="mega-title">Más allá del chat GPT</div>
                  <div class="mega-subtitle">Online</div>
                </div>
              </a>
              <a class="mega-item" href="https://www.youtube.com/watch?v=lmYKJHbSgEY&t=1215s" target="_blank" rel="noopener noreferrer">
                <div class="mega-thumb"><img src="/assets/proyectos/ana_converted.webp" alt=""></div>
                <div class="mega-text">
                  <div class="mega-title">Probé todos los Agentes de IA para diseñar interfaces</div>
                  <div class="mega-subtitle">Online</div>
                </div>
              </a>
            </div>
          </div>
        </div>
      </li>
      <li class="dots">&#183;</li>

      <li class="list-item">
        <a href="https://cards.uxanarangel.com" target="_blank" rel="noopener noreferrer">
          <span class="symbol">×</span>
          <span class="cards">CARDS</span>
        </a>
      </li>

      <!-- <li class="toggle-container">
        <LanguageToggle />
      </li> -->
    </ul>
  </nav>

  <div class="burger" data-status="close">
    <span class="bars bar-top"></span>
    <span class="bars bar-middle"></span>
    <span class="bars bar-bottom"></span>
  </div>
</header>

<style>
  :root {
    --color-bg: hsla(0deg 0% 0% 0.5);
    --color-menu-open: hsla(0deg 0% 0% / 80%);
  }

  .nav-container {
    position: relative;
    z-index: 10;
    display: flex;
    justify-content: space-between;
    inline-size: auto;
    padding-inline: 1.5rem;
    padding-block: 2rem;
    transition: transform 0.3s ease-in-out;
  }

  .navbar {
    position: absolute;
    z-index: 1;
    display: flex;
    justify-content: flex-end;
    background-color: hsla(0deg 0% 3% / 80%);
    transform: translateY(-300%);
    transition: transform 300ms ease-in-out, opacity 300ms ease-in-out;
    inset: 0;
    inline-size: 100%;
    block-size: 100svh;
    padding-block-start: 7rem;

    &[data-status='open'] {
      background-color: var(--color-menu-open);
      transform: translateY(0);
      backdrop-filter: blur(0.1rem);
    }
  }

  .list {
    align-items: center;
    display: flex;
    flex-direction: column;
    margin-inline: auto;
    gap: 1.5rem;
    font-size: 1.7rem;
    line-height: 2.5rem;
    color: white;
    width: 100%;
    padding-inline: 1rem;
  }

  .dots { display: none; }

  /* =========================
     MEGA MENU - MOBILE (inline accordion)
     ========================= */
  .has-mega { width: 100%; }

  .mega-trigger {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
  }

  .mega-trigger::after {
    content: "▾";
    opacity: 0.85;
    transform: translateY(1px);
  }

  .mega-panel {
    position: static;             /* inline */
    width: 100%;
    margin-top: 0.75rem;

    background: rgba(10, 10, 10, 0.6);
    border: 1px solid rgba(177, 179, 208, 0.28);
    border-radius: 16px;
    padding: 14px;

    display: none;                /* cerrado por default en mobile */
  }

  .has-mega.is-open .mega-panel {
    display: block;
  }

  .mega-grid { display: grid; gap: 14px; }
  .mega-grid-1 { grid-template-columns: 1fr; }
  .mega-grid-2 { grid-template-columns: 1fr; } /* en mobile se apila */

  .mega-col-title {
    font-size: 0.95rem;
    margin: 0 0 10px 0;
    color: #fff;
    opacity: 0.9;
  }

  .mega-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px;
    border-radius: 14px;
    text-decoration: none;
  }

  .mega-item:hover {
    background: rgba(255,255,255,0.06);
  }

  .mega-thumb {
    width: 44px;
    height: 44px;
    background: #000;
    border: 1px solid rgba(177, 179, 208, 0.45);
    border-radius: 10px;
    overflow: hidden;
    flex-shrink: 0;
  }

  .mega-thumb img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0.86;
    display: block;
  }

  .mega-title {
    color: #fff;
    font-weight: 600;
    font-size: 1rem;
    line-height: 1.1rem;
  }

  .mega-subtitle {
    color: rgba(177, 179, 208, 0.9);
    font-size: 0.9rem;
    line-height: 1.2rem;
  }

  /* Burger (igual que el tuyo) */
  .burger {
    position: relative;
    inset-block-start: 0.3rem;
    z-index: 2;
    inline-size: 2rem;
    block-size: 2.8125rem;
    cursor: pointer;
  }

  .bars {
    position: absolute;
    inset-inline-start: 0;
    display: block;
    inline-size: 100%;
    block-size: 0.3rem;
    border-radius: 0.5625rem;
    background: white;
    transition: transform 0.25s ease-in-out, opacity 0.25s ease-in-out, inset 0.25s ease-in-out;
  }

  .bar-middle { inset-block-start: 0.65rem; }
  .bar-bottom { inset-block-start: 1.25rem; }

  .burger[data-status='open'] {
    .bar-top { inset-block-start: 1.125rem; transform: rotate(135deg); }
    .bar-middle { inset-inline-start: -3.75rem; opacity: 0; }
    .bar-bottom { inset-block-start: 1.125rem; transform: rotate(-135deg); }
  }

  /* =========================
     DESKTOP (popover mega menu)
     ========================= */
  @media (width >= 50rem) {
    .burger { display: none; }
    .dots { display: flex; font-size: 2.5rem; color: #b1b3d0; }

    .nav-container {
      position: fixed;
      display: flex;
      gap: 1.5rem;
      padding: 0.7rem 1.5rem;
      align-items: center;
      border: 0.2px solid hsla(234deg 15% 37% / 100%);
      border-radius: 2rem;
      background-color: rgba(10, 10, 10, 0.7);
      backdrop-filter: blur(10px);
      inset-block-start: 1.2rem;
      inset-inline: 0;
      inline-size: fit-content;
      margin-inline: auto;
    }

    .navbar {
      display: contents;
      background-color: var(--color-bg);
      transform: translateY(0);
      inset: 0;
      padding: 0;
    }

    .list {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 1.2rem;
      font-size: 1rem;
      padding-inline: 0;
      width: auto;
    }

    .list-item { position: relative; width: auto; padding-inline: 0.5rem; color: #b1b3d0; }

    /* desktop: quitar flecha en trigger */
    .mega-trigger::after { content: ""; }

    .mega-panel {
      position: absolute;
      top: calc(100% + 14px);
      left: 0;
      width: 720px;

      background: rgba(10, 10, 10, 0.92);
      border: 1px solid rgba(177, 179, 208, 0.28);
      border-radius: 22px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.35);
      backdrop-filter: blur(10px);

      padding: 22px;

      display: block; /* en desktop existe pero se oculta por opacity */
      opacity: 0;
      visibility: hidden;
      transform: translateY(18px) scale(0.98);
      transition: all 280ms ease;
      margin-top: 0;
    }

    .has-mega:hover .mega-panel,
    .has-mega.is-open .mega-panel {
      opacity: 1;
      visibility: visible;
      transform: translateY(0) scale(1);
    }

    .mega-grid-2 { grid-template-columns: 1fr 1fr; }
  }
</style>

<script is:inline>
  const navBar = document.querySelector('.navbar')
  const burgerMenu = document.querySelector('.burger')
  const dataStatus = 'data-status'

  // ===== Burger menu toggle =====
  burgerMenu.addEventListener('click', () => {
    const isOpen = navBar.getAttribute(dataStatus) === 'open'

    if (isOpen) {
      document.querySelector('body').style.removeProperty('overflow-y')
      navBar.setAttribute(dataStatus, 'close')
      burgerMenu.setAttribute(dataStatus, 'close')
    } else {
      document.querySelector('body').style.overflowY = 'hidden'
      navBar.setAttribute(dataStatus, 'open')
      burgerMenu.setAttribute(dataStatus, 'open')
    }
  })

  // ===== Mega menu: SOLO mobile por click (accordion) =====
  const megaTriggers = document.querySelectorAll('.has-mega > .mega-trigger')
  const isDesktop = () => window.matchMedia('(min-width: 50rem)').matches

  megaTriggers.forEach((trigger) => {
    trigger.addEventListener('click', (e) => {
      // Desktop: hover manda, el click no hace nada (y evitamos "sticky")
      if (isDesktop()) return

      e.preventDefault()

      const parent = trigger.closest('.has-mega')
      const opened = parent.classList.contains('is-open')

      if (opened) {
        parent.classList.remove('is-open')
        trigger.setAttribute('aria-expanded', 'false')
      } else {
        parent.classList.add('is-open')
        trigger.setAttribute('aria-expanded', 'true')
      }
    })
  })

  // Si cambias tamaño (mobile <-> desktop), cierra acordeones para evitar estados raros
  window.addEventListener('resize', () => {
    if (isDesktop()) {
      document.querySelectorAll('.has-mega.is-open').forEach((el) => {
        el.classList.remove('is-open')
        const t = el.querySelector('.mega-trigger')
        if (t) t.setAttribute('aria-expanded', 'false')
      })
    }
  })
</script>